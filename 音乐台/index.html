<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0">
    <title>音乐台</title>
    <link rel="stylesheet" href="css/index.css"/>
</head>
<body>
<div id="wrap">
    <div class="head">
        <div class="head-top">
            <!--    LOGO   -->
            <a class="logo" href="javascript:;">
                <img src="img/logo.png">
            </a>
            <!--   菜单按钮  -->
            <a class="menu-button" href="javascript:;">
            </a>
            <!--  按钮排 -->
            <div class="btns">
                <a href="javascript:;" class="seatch-btn">搜索</a>
                <a href="javascript:;" class="login-btn">登录</a>
                <a href="javascript:;" class="register-btn">注册</a>
            </div>
        </div>
        <div class="head-bottom">
            <!--     搜索框       -->
            <form>
                <input type="text" name="search-content" class="search-input" placeholder="请点击">
                <input type="submit" class="search-sub" name="查询">
            </form>
        </div>
        <ul class="menu">
            <li>首页</li>
            <li>MV</li>
            <li>悦单</li>
            <li>V版</li>

            <li>音乐</li>
            <li>商城</li>
            <li>节目</li>
            <li>饭店</li>

            <li>咨询</li>
            <li>我的家</li>
            <li>APP下载</li>
            <li>热门应用</li>
        </ul>
    </div>
    <div class="content">
        <div class="nav">
            <ul class="list">
                <li class="active">
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V版</a>
                </li>
                <li>
                    <a href="javascript:;">音乐</a>
                </li>
                <li>
                    <a href="javascript:;">商城</a>
                </li>
                <li>
                    <a href="javascript:;">节目</a>
                </li>
                <li>
                    <a href="javascript:;">饭店</a>
                </li>
                <li>
                    <a href="javascript:;">咨询</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
                <li>
                    <a href="javascript:;">晓飞张</a>
                </li>
                <li>
                    <a href="javascript:;">金龙油</a>
                </li>
                <li>
                    <a href="javascript:;">邱海峰</a>
                </li>
                <li>
                    <a href="javascript:;">小贱贱</a>
                </li>
                <li>
                    <a href="javascript:;">你</a>
                </li>
            </ul>
        </div>
    </div>
</div>
</body>
<script src="js/tools.js" type="application/javascript"></script>
<script src="js/component.js" type="application/javascript"></script>
<script>
    window.onload = function () {

        // 禁止所有默认触摸事件，ps:PC的谷歌浏览器不支持，但真机可以
        document.addEventListener('touchstart', function (e) {
            e = e || event;
            e.preventDefault();
        })

        // rem适配
        ;(function () {
            let styleNode = document.createElement("style");
            console.log("w");
            let w = document.documentElement.clientWidth / 16;
            console.log(w);
            styleNode.innerHTML = "html{font-size:" + w + "px!important}";
            document.head.append(styleNode)
        })();

        // 点击菜单按钮
        clickMenuBtn();
        function clickMenuBtn() {
            let btnObj = document.querySelector("#wrap .head .head-top .menu-button");
            let menuObj = document.querySelector("#wrap .head .menu");

            let isActive = false;
            // 点击菜单按钮
            btnObj.addEventListener('touchstart', function (e) {
                e = e || event;
                let touch = e.changedTouches[0];
                if (!isActive) {
                    tools.addClass(btnObj, 'active');
                    menuObj.style.display = 'block'
                } else {
                    tools.removeClass(btnObj, 'active');
                    menuObj.style.display = 'none'
                }
                isActive = !isActive;
                e.stopPropagation();
                e.preventDefault()
            });
            // 点击除弹出的菜单的以外的区域，关闭菜单
            document.addEventListener('touchstart', function (e) {
                e = e || event;
                if (isActive) {
                    tools.removeClass(btnObj, 'active');
                    menuObj.style.display = 'none';
                    isActive = !isActive; // 这里记得要置成false
                }

            });
            // 点击菜单区域，不关闭菜单
            menuObj.addEventListener('touchstart', function (e) {
                e = e || event;
                e.stopPropagation();
                e.preventDefault();
            })
        }

        // 搜索框获取焦点
        searchInputFoucs();
        function searchInputFoucs() {
            let searchInputObj = document.querySelector('#wrap .head .head-bottom form .search-input');
            searchInputObj.addEventListener('touchstart', function (e) {
                e = e || event;
                this.focus();
                e.stopPropagation();
                e.preventDefault();
            });
            document.addEventListener('touchstart', function (e) {
                searchInputObj.blur();
            })
        }

        // 拖拽
        navDrag();
        function navDrag() {
           // 滑屏区域
           let wrapObj = document.querySelector('#wrap .content .nav');
           // 滑动元素
           let urlObj = document.querySelector('#wrap .content .nav .list');

           // 元素一开始的位置
           let startX = 0; // 手指触摸的位置
           let elementX = 0; // 滑动元素的位置

           // 这个代表左移时，移到多少，看到最右边的元算
           let minX = wrapObj.clientWidth - urlObj.offsetWidth;

            // 要移动的距离
            let translateX = 0;

            // 快速滑屏的必要参数
            let lastTime = 0; // 上个时间点
            let lastPoint = 0; // 上个位置
            let timeDis = 0; // 时间间隔
            let pointDis = 0; // 两个点的距离

           wrapObj.addEventListener('touchstart', function (ev) {
                ev = ev || event;
                let touchC = ev.changedTouches[0];

                startX = touchC.clientX;
                elementX = component.toTransform(urlObj, 'translateX');

               lastTime = new Date().getTime();
               lastPoint = component.toTransform(urlObj, 'translateX');

               //清除速度的残留
               pointDis=0;
               timeDis = 0;

           });

            wrapObj.addEventListener('touchmove', function (ev) {
                ev = ev || event;
                let touchC = ev.changedTouches[0];
                let nowX = touchC.clientX;
                let disX = nowX - startX;
                translateX = elementX + disX;

                /**
                 * 橡皮筋效果
                 * 在move的过程中，每一次touchmove真正的有效距离慢慢变小，元素的滑动距离还是在变大
                 */
                if (translateX > 0) {
                    let scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + translateX) * 1.5);
                    translateX = elementX + disX * scale;
                } else if (translateX < minX) {
                    let over = minX - translateX;
                    let scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + over) * 1.5);
                    translateX = elementX + disX * scale;
                }

                component.toTransform(urlObj, 'translateX', translateX);

                let nowTime = new Date().getTime();
                let nowPoint = component.toTransform(urlObj, 'translateX');
                timeDis = nowTime - lastTime;
                pointDis = nowPoint - lastPoint;
            });

            wrapObj.addEventListener('touchend', function (ev) {
                ev = ev || event;
                // translateX =  component.toTransform(urlObj, 'translateX');

                //速度越大  位移越远 (快速滑屏幕)
                let speed = pointDis/timeDis;
                speed = Math.abs(speed) < 0.5 ? 0 : speed;

                let targetX = translateX + speed*200;

                let time = Math.abs(speed) * 0.2;
                time = time < 0.8 ? 0.8 : time;
                time = time > 2 ? 2 : time;
                // 快速滑屏橡皮筋效果
                let bsr = '';
                if (targetX >= 0) {
                    targetX = 0;
                    bsr = "cubic-bezier(.26,1.51,.68,1.54) "
                } else if (targetX <= minX) {
                    targetX = minX;
                    bsr = "cubic-bezier(.26,1.51,.68,1.54) "
                }
                urlObj.style.transition = time+"s "+bsr+" transform";
                component.toTransform(urlObj, 'translateX', targetX)
            })

        }
    }
</script>
</html>